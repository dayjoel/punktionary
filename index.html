<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <title>PUNKtionary - Your Local Punk Scene Directory</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/css/punk-styles.css">

  <style>
    /* Smooth caption animation */
    .caption-enter {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    .caption-enter-active {
      opacity: 1;
      transform: translateY(0);
    }

    /* Carousel enhancements */
    .carousel-container {
      position: relative;
      border: 3px solid var(--punk-pink);
      box-shadow: 0 0 30px rgba(255, 0, 110, 0.3);
    }

    /* Dot indicators with punk style */
    .carousel-dot {
      width: 12px;
      height: 12px;
      border-radius: 0;
      border: 2px solid var(--punk-pink);
      background: transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
    }

    .carousel-dot:hover {
      background: rgba(255, 0, 110, 0.5);
      transform: scale(1.2);
    }

    .carousel-dot.active {
      background: var(--punk-pink);
      box-shadow: 0 0 10px rgba(255, 0, 110, 0.8);
    }

    /* Hero glow effect */
    .hero-glow {
      position: relative;
    }

    .hero-glow::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, var(--punk-pink), transparent, var(--punk-pink));
      z-index: -1;
      opacity: 0.3;
      animation: rotate-gradient 3s linear infinite;
    }

    @keyframes rotate-gradient {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-black text-white font-sans">

  <!-- Include Navbar -->
  <div id="navbar-container"></div>

  <!-- Include Login Modal -->
  <div id="login-modal-container"></div>

  <!-- Submit News Modal -->
  <div id="submitNewsModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="punk-card max-w-lg w-full">
      <div class="flex justify-between items-start mb-6">
        <h2 class="text-3xl font-bold uppercase tracking-wider" style="font-family: 'Bebas Neue', sans-serif;">
          Submit News
        </h2>
        <button id="closeNewsModal" class="text-pink-500 hover:text-pink-400 text-3xl leading-none">&times;</button>
      </div>

      <p class="text-gray-300 mb-6">
        Share punk scene news! Paste a link to an article, social media post, or announcement. We'll review and add it to the homepage carousel.
      </p>

      <form id="submitNewsForm" class="space-y-4">
        <div>
          <label class="block text-sm font-bold mb-2 text-pink-500 uppercase tracking-wide">News URL *</label>
          <input type="url"
                 id="newsUrl"
                 name="url"
                 class="punk-input w-full"
                 placeholder="https://example.com/punk-news"
                 required />
          <p class="text-xs text-gray-500 mt-1">Link to news article, social media post, or event announcement</p>
        </div>

        <button type="submit" class="punk-button w-full">
          Submit for Review
        </button>
      </form>

      <div id="newsSuccessMessage" class="hidden mt-4 p-4 bg-green-900/50 border border-green-500 text-green-400 rounded">
        <p class="font-bold">Success!</p>
        <p class="text-sm">Your news submission has been received and will be reviewed by our team.</p>
      </div>

      <div id="newsErrorMessage" class="hidden mt-4 p-4 bg-red-900/50 border border-red-500 text-red-400 rounded"></div>
    </div>
  </div>

  <main class="pt-24 max-w-6xl mx-auto px-6 grid grid-cols-1 lg:grid-cols-3 gap-12">

    <!-- Primary Column -->
    <section class="lg:col-span-2 space-y-12">

      <!-- Image Carousel -->
      <div class="carousel-container relative w-full h-64 sm:h-96 overflow-hidden bg-black">
        <!-- Loading State -->
        <div id="carouselLoading" class="absolute inset-0 flex items-center justify-center">
          <div class="text-center">
            <div class="inline-block w-12 h-12 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mb-3"></div>
            <p class="text-gray-400 text-sm">Loading carousel...</p>
          </div>
        </div>

        <!-- Image -->
        <img id="carouselImage"
             src=""
             alt="Featured content"
             class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-1000" />

        <!-- Overlay -->
        <div id="carouselOverlay" class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black via-black/80 to-transparent p-6 opacity-0">
          <div id="captionWrapper" class="caption-enter">
            <h2 id="carouselCaption" class="text-2xl font-bold mb-3 text-white" style="font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.05em;">
            </h2>
            <a id="carouselLink"
               href="#"
               target="_blank"
               rel="noopener noreferrer"
               class="punk-button inline-block">
            </a>
          </div>
        </div>

        <!-- Navigation Dots -->
        <div id="carouselDots" class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-3 z-10">
          <!-- Dots will be added dynamically -->
        </div>

        <!-- Submit News Link -->
        <button id="submitNewsBtn" class="absolute bottom-4 right-4 text-xs text-pink-500 hover:text-pink-400 underline z-20 bg-black/50 px-2 py-1 rounded">
          Submit Your News
        </button>
      </div>

      <!-- Welcome Text -->
      <section class="punk-hero py-8">
        <h1 class="text-5xl md:text-6xl font-bold mb-6">Welcome to PUNKtionary</h1>
        <p class="text-gray-300 text-xl max-w-3xl leading-relaxed">
          Discover bands, venues, and resources that keep your local scene alive.
        </p>
        <div class="flex gap-4 mt-8">
          <a href="/bands.html" class="punk-button">Explore Bands</a>
          <a href="/venues.html" class="punk-button-outline">Find Venues</a>
        </div>
      </section>
    </section>

    <!-- Sidebar -->
    <aside class="lg:col-span-1 space-y-8">
      <!-- Recently Added Bands -->
      <section class="featured-card p-6">
        <h2 class="text-2xl font-semibold mb-4 uppercase tracking-wider" style="font-family: 'Bebas Neue', sans-serif;">
          Recently Added Bands
        </h2>
        <ul id="recentBandsList" class="punk-list space-y-2">
          <li class="text-gray-400 text-sm">Loading...</li>
        </ul>
        <a href="/bands.html" class="punk-button-outline w-full text-center mt-6 block">
          View All Bands
        </a>
      </section>

      <!-- Recently Added Venues -->
      <section class="featured-card p-6">
        <h2 class="text-2xl font-semibold mb-4 uppercase tracking-wider" style="font-family: 'Bebas Neue', sans-serif;">
          Recently Added Venues
        </h2>
        <ul id="recentVenuesList" class="punk-list space-y-2">
          <li class="text-gray-400 text-sm">Loading...</li>
        </ul>
        <a href="/venues.html" class="punk-button-outline w-full text-center mt-6 block">
          View All Venues
        </a>
      </section>
    </aside>

  </main>

  <!-- Footer -->
  <footer class="bg-black border-t-2 border-pink-500 py-6 mt-24">
    <div class="max-w-7xl mx-auto px-6 text-center text-gray-400 text-sm">
      <p class="mb-3">&copy; 2026 PUNKtionary. All rights reserved.</p>
      <div class="flex justify-center gap-6 mb-3">
        <a href="/about.html" class="punk-link">About</a>
        <a href="/contact.html" class="punk-link">Contact</a>
        <a href="/submit.html" class="punk-link">Submit</a>
      </div>
      <div class="flex justify-center gap-6 text-xs">
        <a href="/privacy.html" class="punk-link">Privacy Policy</a>
        <a href="/terms.html" class="punk-link">Terms of Service</a>
        <a href="/data-deletion.html" class="punk-link">Data Deletion</a>
      </div>
    </div>
  </footer>

  <!-- Load Navbar -->
  <script>
    fetch('/navbar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('navbar-container').innerHTML = data;
        if (typeof initNavbar === 'function') {
          initNavbar();
        }
      })
      .catch(error => console.error('Error loading navbar:', error));
  </script>

  <!-- Load Login Modal -->
  <script>
    fetch('/login-modal.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('login-modal-container').innerHTML = data;
        // Initialize modal controls after it's loaded
        if (typeof initLoginModal === 'function') {
          initLoginModal();
        }
      })
      .catch(error => console.error('Error loading login modal:', error));
  </script>

  <script src="/navbar.js"></script>

  <!-- Load Recent Entries -->
  <script>
    (async function loadRecent() {
      try {
        const response = await fetch('get_recent.php');
        const data = await response.json();

        if (data.success) {
          // Populate recent bands
          const bandsList = document.getElementById('recentBandsList');
          if (data.bands && data.bands.length > 0) {
            bandsList.innerHTML = data.bands.map(band => 
              `<li class="text-gray-300 hover:text-pink-500 cursor-pointer transition-colors">
                <a href="/band.html?id=${band.id}" class="block">${band.name}</a>
              </li>`
            ).join('');
          } else {
            bandsList.innerHTML = '<li class="text-gray-500 text-sm">No bands yet</li>';
          }

          // Populate recent venues
          const venuesList = document.getElementById('recentVenuesList');
          if (data.venues && data.venues.length > 0) {
            venuesList.innerHTML = data.venues.map(venue => 
              `<li class="text-gray-300 hover:text-pink-500 cursor-pointer transition-colors">
                <a href="/venue.html?id=${venue.id}" class="block">${venue.name}</a>
              </li>`
            ).join('');
          } else {
            venuesList.innerHTML = '<li class="text-gray-500 text-sm">No venues yet</li>';
          }
        }
      } catch (error) {
        console.error('Error loading recent entries:', error);
        const bandsList = document.getElementById('recentBandsList');
        const venuesList = document.getElementById('recentVenuesList');
        if (bandsList) bandsList.innerHTML = '<li class="text-gray-500 text-sm">Unable to load</li>';
        if (venuesList) venuesList.innerHTML = '<li class="text-gray-500 text-sm">Unable to load</li>';
      }
    })();
  </script>

  <!-- Carousel Script -->
  <script>
    // Fallback slides if API fails or returns no items
    const fallbackSlides = [
      {
        image: '/images/home/Dead_Pioneers_carousel1.webp',
        caption: 'Dead Pioneers fundraising for new record',
        link: 'https://www.instagram.com/reel/DQC_v_ggGm6/',
        linkText: 'Instagram'
      },
      {
        image: '/images/home/lambrinigirls_carousel3.jpg',
        caption: 'Lambrini Girls - God\'s Country at The Crocodile',
        link: 'https://youtu.be/99r-0hlL3JM?si=AxAI82jLXEjgco1X',
        linkText: 'YouTube'
      },
      {
        image: '/images/home/nofunbar_carousel4.avif',
        caption: 'Local Scene Highlight â€” No Fun Bar - Portland, OR',
        link: 'https://www.nofunportland.com/',
        linkText: 'Visit'
      },
      {
        image: '/images/home/subjunctives_carousel6.jpg',
        caption: 'Subjunctives preparing a new LP',
        link: 'https://www.thesubjunctives.com/',
        linkText: 'Website'
      },
      {
        image: '/images/home/converge_carousel2.jpg',
        caption: 'Converge performing Concubine at El Corazon',
        link: 'https://youtu.be/_whdfIUI43M?si=W4Sa3_0kl7tjTt8L',
        linkText: 'YouTube'
      },
      {
        image: '/images/home/grrrizzly_carousel7.jpg',
        caption: 'Olympia\'s Grrrizzly on west coast tour',
        link: 'https://www.instagram.com/grrrizzlyband/',
        linkText: 'Follow'
      }
    ];

    let slides = [];
    let currentIndex = 0;
    let carouselInterval = null;
    const imageEl = document.getElementById('carouselImage');
    const captionWrapper = document.getElementById('captionWrapper');
    const captionEl = document.getElementById('carouselCaption');
    const linkEl = document.getElementById('carouselLink');
    const dotsContainer = document.getElementById('carouselDots');

    // Load carousel items from API
    async function loadCarouselItems() {
      try {
        const response = await fetch('/api/carousel_items.php');
        const data = await response.json();

        if (data.success && data.items && data.items.length > 0) {
          // Convert API items to slide format
          slides = data.items.map(item => {
            // Clean up link_url - trim whitespace and treat empty strings as null
            const cleanLink = item.link_url ? item.link_url.trim() : null;

            // Debug log for troubleshooting
            console.log('Carousel item:', {
              title: item.title,
              link_url_raw: item.link_url,
              link_url_cleaned: cleanLink
            });

            return {
              image: item.image_url,
              caption: item.title,
              link: cleanLink || null,
              linkText: cleanLink ? 'Learn More' : ''
            };
          });
        } else {
          // Use fallback slides if no items from API
          slides = fallbackSlides;
        }
      } catch (error) {
        console.error('Error loading carousel items:', error);
        // Use fallback slides on error
        slides = fallbackSlides;
      }

      // Initialize carousel with loaded slides
      initializeCarousel();
    }

    function initializeCarousel() {
      // Clear existing dots
      dotsContainer.innerHTML = '';

      // Create dots dynamically with punk style
      slides.forEach((_, i) => {
        const dot = document.createElement('div');
        dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
        dot.addEventListener('click', () => showSlide(i));
        dotsContainer.appendChild(dot);
      });

      // Show first slide
      if (slides.length > 0) {
        showSlide(0, true); // true = initial load, no transition
      }

      // Start auto-rotation
      if (carouselInterval) {
        clearInterval(carouselInterval);
      }
      if (slides.length > 1) {
        carouselInterval = setInterval(nextSlide, 5000);
      }
    }

    function showSlide(index, isInitial = false) {
      const dots = dotsContainer.querySelectorAll('div');

      if (!isInitial) {
        imageEl.classList.add('opacity-0');
        captionWrapper.classList.remove('caption-enter-active');
      }

      currentIndex = index;

      const updateSlide = () => {
        const slide = slides[currentIndex];
        imageEl.src = slide.image;
        imageEl.alt = slide.caption;
        captionEl.textContent = slide.caption;

        if (slide.link) {
          linkEl.href = slide.link;
          linkEl.textContent = slide.linkText || 'Learn More';
          linkEl.classList.remove('hidden');
        } else {
          linkEl.classList.add('hidden');
        }

        if (isInitial) {
          // Hide loading state and show carousel content
          const loadingEl = document.getElementById('carouselLoading');
          if (loadingEl) {
            loadingEl.classList.add('hidden');
          }
          imageEl.classList.remove('opacity-0');
          imageEl.classList.add('opacity-100');
          document.getElementById('carouselOverlay').classList.remove('opacity-0');
          document.getElementById('carouselOverlay').classList.add('opacity-100');
          // Also apply caption animation for initial load
          captionWrapper.classList.add('caption-enter-active');
        } else {
          imageEl.classList.remove('opacity-0');
          captionWrapper.classList.add('caption-enter');
          setTimeout(() => captionWrapper.classList.add('caption-enter-active'), 10);
        }

        dots.forEach((d, i) => {
          if (i === currentIndex) {
            d.classList.add('active');
          } else {
            d.classList.remove('active');
          }
        });
      };

      if (isInitial) {
        updateSlide();
      } else {
        setTimeout(updateSlide, 1000);
      }
    }

    function nextSlide() {
      const nextIndex = (currentIndex + 1) % slides.length;
      showSlide(nextIndex);
    }

    // Load carousel when page loads
    loadCarouselItems();
  </script>

  <!-- Submit News Modal Script -->
  <script>
    // Modal controls
    const submitNewsBtn = document.getElementById('submitNewsBtn');
    const submitNewsModal = document.getElementById('submitNewsModal');
    const closeNewsModal = document.getElementById('closeNewsModal');
    const submitNewsForm = document.getElementById('submitNewsForm');
    const newsSuccessMessage = document.getElementById('newsSuccessMessage');
    const newsErrorMessage = document.getElementById('newsErrorMessage');

    // Open modal
    submitNewsBtn.addEventListener('click', function() {
      submitNewsModal.classList.remove('hidden');
    });

    // Close modal
    closeNewsModal.addEventListener('click', function() {
      submitNewsModal.classList.add('hidden');
      submitNewsForm.reset();
      newsSuccessMessage.classList.add('hidden');
      newsErrorMessage.classList.add('hidden');
    });

    // Close on backdrop click
    submitNewsModal.addEventListener('click', function(e) {
      if (e.target === submitNewsModal) {
        closeNewsModal.click();
      }
    });

    // Handle form submission
    submitNewsForm.addEventListener('submit', async function(e) {
      e.preventDefault();

      const url = document.getElementById('newsUrl').value.trim();
      const submitBtn = submitNewsForm.querySelector('button[type="submit"]');

      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      newsSuccessMessage.classList.add('hidden');
      newsErrorMessage.classList.add('hidden');

      try {
        const response = await fetch('/api/submit_carousel_news.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `url=${encodeURIComponent(url)}`
        });

        const data = await response.json();

        if (data.success) {
          newsSuccessMessage.classList.remove('hidden');
          submitNewsForm.reset();

          setTimeout(() => {
            closeNewsModal.click();
          }, 3000);
        } else {
          throw new Error(data.error || 'Submission failed');
        }
      } catch (error) {
        console.error('News submission error:', error);
        newsErrorMessage.textContent = error.message || 'Failed to submit news. Please try again.';
        newsErrorMessage.classList.remove('hidden');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit for Review';
      }
    });
  </script>

</body>
</html>